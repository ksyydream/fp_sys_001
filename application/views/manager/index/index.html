{{include file='manager/public/head.html'}}
<body class="no-skin">
{{include file='manager/public/header.html'}}
<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>
    <script src="http://cdn.bootcss.com/jquery/1.12.3/jquery.min.js"></script>
    {{include file='manager/public/sidebar.html'}}
    <div class="main-content kanban_div">
        <div class="main-content-inner">
            <!-- #section:basics/content.breadcrumbs -->
            {{include file='manager/public/breadcrumbs.html'}}
            <!-- /section:basics/content.breadcrumbs -->
            <div class="page-content">
                {{include file='manager/public/set.html'}}

                <!-- /section:settings.box -->
                <div class="row">
                    <div class="col-xs-12">

                        <!-- PAGE CONTENT BEGINS -->

                        <div class="cf">

                            <div class="form-inline">
                                <label class="inline">搜索车牌：</label>

                                <input type="text" id="search_input" value="" class="form-control" placeholder="车牌">

                                <a class="btn btn-info" href="javascript:;" id="search_a">查询</a>

                            </div>


                        </div>

                        <div class="space-4"></div>

                        <!-- PAGE CONTENT ENDS -->

                    </div><!-- /.col -->
                    <div class="box">
                        {{foreach from=$res_list key=k item=v}}
                        <div class="cangku">
                            <table >
                                <tr>
                                    {{foreach from=$v.t_list key=k2 item=vv}}
                                    {{if $vv.status == 1}}
                                    <td class="type2 {{if $k2==0}}t_l{{/if}} {{if $k2==($v.max_length-1)}}t_r{{/if}}" onClick="shifang({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                        {{if $vv.task == 1}}装{{/if}}
                                        {{if $vv.task == 2}}卸{{/if}}
                                        {{if $vv.task == 3}}机{{/if}}
                                        {{if $vv.task == -1}}待{{/if}}
                                    </p>
                                    <div class='fushifang fushifang_b'><i></i>
                                        <a href='javascript:;' class="fushifang_a" onClick="fushifang_a('{{$vv.location}}','{{$vv.car_no}}','{{$v.id}}','{{$v.warehouse}}')">占用</a>
                                    </div>
                                    </td>
                                    {{/if}}
                                    {{if $vv.status == 2}}
                                    <td class="type3 {{if $k2==0}}t_l{{/if}} {{if $k2==($v.max_length-1)}}t_r{{/if}}" onClick="zhuan({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                        {{if $vv.task == 1}}装{{/if}}
                                        {{if $vv.task == 2}}卸{{/if}}
                                        {{if $vv.task == 3}}机{{/if}}
                                        {{if $vv.task == -1}}待{{/if}}
                                </p>
                                    <div class='fuzhan fuzhan_b' style="height: 66px"><i></i>
                                        <a href='javascript:;' class="fuzhan_a" onClick="fuzhan_a('{{$vv.location}}','{{$v.id}}','{{$v.warehouse}}')">释放</a>
                                        <a href='javascript:;' class="fushifang_a" onClick="fushifang_a('{{$vv.location}}','{{$vv.car_no}}','{{$v.id}}','{{$v.warehouse}}')">占用</a>
                                    </div>
                                    <div class='fuchepai fuchepai_b'><i></i>车牌：{{$vv.car_no}}</div>
                                    </td>
                                    {{/if}}
                                    {{if $vv.status == 3}}
                                    <td class="type1 {{if $k2==0}}t_l{{/if}} {{if $k2==($v.max_length-1)}}t_r{{/if}}" onClick="zhuan({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                    {{if $vv.task == 1}}装{{/if}}
                                    {{if $vv.task == 2}}卸{{/if}}
                                    {{if $vv.task == 3}}机{{/if}}
                                    {{if $vv.task == -1}}待{{/if}}
                                </p>
                                    <div class='fuzhan fuzhan_b'><i></i>
                                        <a href='javascript:;' class="fuzhan_a" onClick="fuzhan_a('{{$vv.location}}','{{$v.id}}','{{$v.warehouse}}')">释放</a>
                                    </div>
                                    <div class='fuchepai fuchepai_b'><i></i>车牌：{{$vv.car_no}}</div>
                                    </td>
                                    {{/if}}
                                    {{/foreach}}
                                </tr>
                                <tr>
                                    <td class="cangku_center" colspan="34">
                                        {{$v.warehouse}}
                                        <div class="zhushi">
                                            <li ><i class="zhanyong"></i>已占用 <span class="zhanyongnum">{{$v.kx_num}}</span>个</li>
                                            <li ><i class="kongxian"></i>空闲 <span class="kongxiannum">{{$v.zy_num}}</span>个</li>
                                            <li ><i class="pipei"></i>已匹配<span class="pipeinum">{{$v.pp_num}}</span>个</li>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    {{foreach from=$v.m_list key=k2 item=vv}}
                                    {{if $vv.status == 1}}
                                    <td class="type2 {{if $k2==0}}m_l{{/if}} {{if $k2==($v.max_length-1)}}m_r{{/if}}" onClick="shifang({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                    {{if $vv.task == 1}}装{{/if}}
                                    {{if $vv.task == 2}}卸{{/if}}
                                    {{if $vv.task == 3}}机{{/if}}
                                    {{if $vv.task == -1}}待{{/if}}
                                </p>
                                    <div class='fushifang fushifang_b'><i></i>
                                        <a href='javascript:;' class="fushifang_a" onClick="fushifang_a('{{$vv.location}}','{{$vv.car_no}}','{{$v.id}}','{{$v.warehouse}}')">占用</a>
                                    </div>
                                    </td>
                                    {{/if}}
                                    {{if $vv.status == 2}}
                                    <td class="type3 {{if $k2==0}}m_l{{/if}} {{if $k2==($v.max_length-1)}}m_r{{/if}}" onClick="zhuan({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                    {{if $vv.task == 1}}装{{/if}}
                                    {{if $vv.task == 2}}卸{{/if}}
                                    {{if $vv.task == 3}}机{{/if}}
                                    {{if $vv.task == -1}}待{{/if}}
                                </p>
                                    <div class='fuzhan fuzhan_b' style="height: 66px"><i></i>
                                        <a href='javascript:;' class="fuzhan_a" onClick="fuzhan_a('{{$vv.location}}','{{$v.id}}','{{$v.warehouse}}')">释放</a>
                                        <a href='javascript:;' class="fushifang_a" onClick="fushifang_a('{{$vv.location}}','{{$vv.car_no}}','{{$v.id}}','{{$v.warehouse}}')">占用</a>
                                    </div>
                                    <div class='fuchepai fuchepai_b'><i></i>车牌：{{$vv.car_no}}</div>
                                    </td>
                                    {{/if}}
                                    {{if $vv.status == 3}}
                                    <td class="type1 {{if $k2==0}}m_l{{/if}} {{if $k2==($v.max_length-1)}}m_r{{/if}}" onClick="zhuan({{$vv.location}},this)">
                                    <p class="num">{{$vv.location}}</p><p class="txt">
                                    {{if $vv.task == 1}}装{{/if}}
                                    {{if $vv.task == 2}}卸{{/if}}
                                    {{if $vv.task == 3}}机{{/if}}
                                    {{if $vv.task == -1}}待{{/if}}
                                </p>
                                    <div class='fuzhan fuzhan_b'><i></i>
                                        <a href='javascript:;' class="fuzhan_a" onClick="fuzhan_a('{{$vv.location}}','{{$v.id}}','{{$v.warehouse}}')">释放</a>
                                    </div>
                                    <div class='fuchepai fuchepai_b'><i></i>车牌：{{$vv.car_no}}</div>
                                    </td>
                                    {{/if}}
                                    {{/foreach}}

                                </tr>
                            </table>
                        </div>
                        {{/foreach}}
                    </div>
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->
    {{include file='manager/public/footer.html'}}

</div><!-- /.main-container -->
{{include file='manager/public/footerjs.html'}}
<!-- inline scripts related to this page -->
<script>
    function zhuan(id,obj){
        ds =$(obj).find(".fuzhan").css('display');
        $(".fuzhan").hide();
        $(".fushifang").hide();
        if(ds=='block'){
            $(obj).find(".fuzhan").hide();
            $(obj).find(".fushifang").hide();
        }else{
            $(obj).find(".fuzhan").show();
            $(obj).find(".fushifang").show();
        }
    }
    function shifang(id,obj){
        ds =$(obj).find(".fushifang").css('display');
        $(".fushifang").hide();
        $(".fuzhan").hide();
        if(ds=='block'){
            $(obj).find(".fuzhan").hide();
            $(obj).find(".fushifang").hide();
        }else{
            $(obj).find(".fuzhan").show();
            $(obj).find(".fushifang").show();
        }


    }
    $(function(){
        $(".type3").hover(function(){
            $(this).find(".fuchepai").show();
        },function(){
            $(this).find(".fuchepai").hide();
        })
        $(".type1").hover(function(){
            $(this).find(".fuchepai").show();
        },function(){
            $(this).find(".fuchepai").hide();
        })
    })


    function fuzhan_a(w_location,w_id,warehouse){
        layer.confirm('确认释放' + warehouse + '的' + w_location + '月台吗？', {
            btn: ['确认','取消'], //按钮
        }, function(){
            $.getJSON("/manager/release_location/" + w_id + "/" + w_location,function(data){
                if(data == 1){
                    layer.msg('释放成功', {icon: 1});
                }else if(data == -2){
                    layer.msg('月台不存在!', {icon: 2});
                }else if(data == -3){
                    layer.msg('已是空闲状态!', {icon: 2});
                }else if(data == -99){
                    layer.msg('你没有操作权限!', {icon: 2});
                }else{
                    layer.msg('释放失败!', {icon: 2});
                }
                location.reload();
            })

        }, function(){

        });

    }



    function fushifang_a(w_location,car_no,w_id,warehouse){
        layer.confirm('确认占用当前月台吗？', {
            btn: ['确认','取消'], //按钮
            content:"<div>" +
            "<p><span>仓库号：</span><span>"+warehouse+"</span></p>" +
            "<p><span>月台号：</span><span>"+w_location+"号月台</span></p>" +
            "<p><span>占用车牌：</span><span><input id='cc' maxlength='7' value='"+car_no+"' /><input type='hidden' id='zy_car_no' value='"+car_no+"' /></span></p></div>"
        }, function(){
           var car_no_ =  $("#cc").val();
           $.getJSON("/manager/occupy_location/" + w_id + "/" + w_location + "/" + car_no_,function(data){
                if(data == 1){
                    layer.msg('占用成功', {icon: 1});
                }else if(data == -2){
                    layer.msg('月台不存在!', {icon: 2});
                }else if(data == -3){
                    layer.msg('已被占用!', {icon: 2});
                }else if(data == -4){
                    layer.msg('车牌不规范!', {icon: 2});
                }else if(data == -99){
                    layer.msg('你没有操作权限!', {icon: 2});
                }else{
                    layer.msg('占用失败!', {icon: 2});
                }
               location.reload();
            })
        }, function(){

        });

    }

    $("#search_a").click(function(){
        var search_input = $.trim($("#search_input").val());
        if(search_input == ""){
            layer.msg("请输入车牌!");
            return false;
        }
        $.post("/manager/search_car_info",{car_no:search_input},function(data){
            if(data == -1){
                layer.msg('未找到司机信息!', {icon: 2});
            }else if(data == -99){
                layer.msg('你没有操作权限!', {icon: 2});
            }else{
                var list_data = JSON.parse(data);
                var html = "车牌:" + search_input + "<br/>";
                for(var i in list_data) {
                    html += "司机:" + list_data[i].rel_name + ";  联系电话:" + list_data[i].username + "<br/>";
                }
                layer.alert(html, {
                    skin: 'layui-layer-lan'
                    ,closeBtn: 0
                    ,anim: 4 //动画类型
                });
            }
        })
    })
</script>

</body>
</html>
